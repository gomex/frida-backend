machine:
  environment:
    DATABASE_URL: "mongodb://localhost:27017:bdf_test"
    HEXO_SOURCE_PATH: "/tmp/source/"
    CERT_FILE_PATH: "./test/ssl/ssl.crt"
    KEY_FILE_PATH: "./test/ssl/ssl.key"
    HEXO_DEST_PATH: "/tmp/dest/"

dependencies:
  pre:
    - echo $chave_frida > frida-plain
    - chmod 400 frida-plain
  override:
    - npm cache clean
    - npm install

test:
  override:
    - npm test
    - npm run coverage || true

deployment:
  production:
    tag: production
    commands:
      - ./deploy_prod.sh
  staging:
    branch: master
    commands:
      - ./config_env.sh
      - scp -i frida-plain .env frida@cpmidias-teste.brasildefato.com.br:/home/frida/components/frida-backend/
      - ssh -i frida-plain frida@cpmidias-teste.brasildefato.com.br -C "/home/frida/components/frida-scripts/deploy-frida-backend.sh $CIRCLE_SHA1"
